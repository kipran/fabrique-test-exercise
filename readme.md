# Fabrique test

Проект желательно запускать используя virtual environment Python'a. 

Для создания virtual env нужно в директории fabrique_v выполнить:
> python3 -m venv env

После в зависимости от ОС войти в виртуальное окружение:

Windows:
>env\Scripts\activate.bat

Linux/macOS:
>source env/bin/activate

Теперь нужно установить зависимости проекта:
>pip install -r requirements.txt

После войти в директорию fabrique и выполнить:
>python manage.py migrate

## Начало работы

Для создания пользователя админа нужно выполнить:
>python manage.py createsuperuser

Дальше можно создавать и манипулировать данными либо из панели администратора Django, либо через API эндпоинты описанные ниже

>python manage.py runserver

Для запуска тестового веб-сервера

Панель администратора Django:
>127.0.0.1:8000/admin/

К API можно обращаться через браузер или через любой другой HTTP клиент. Данные передаются в формате JSON, авторизация самая базовая для админских эндпоинтов путём Basic Authenticaion через HTTP.


## API эндпоинты

Корень API:
>127.0.0.1:8000/api/

Дальше методы будут отталкиваться от этого корня. Авторизация через Django REST Framework интерфейс доступна

### Пользовательские:

---

>survey_list/

Отображает список всех доступных на данный момент опросов

>survey_list/<id опроса>/

Более подробное отображение конкретного опроса, внутри содержатся вопросы и варианты ответов на вопросы, если они имеются

Все данные которые мы получили с помощью этого метода используются ниже

---
>user_form_create/

Позволяет создать форму заполнения опроса, которая имеет такую JSON структуру:


    {
    "survey": <id опроса>,
    "user_id": <id пользователя>,
    "answers": [

        {
            "question": <id вопроса>,
            "text": "текстовый ответ, если тип вопроса TEXT_ANSWER",
            "choices": []
        },
        {
            "question": <id вопроса>,
            "text": "",
            "choices": [<id варианта ответа>,<ещё один id варианта ответа>]
        }
    ]
    }


После заполнения мы можешь посмотреть список пройденных пользователем опросов:
>user_form_list/<id пользователя>/

Выведет список всех опросов, который прошёл пользователь. Важное замечание, что пользователь может пройти конкретный опрос только один раз - то есть связка id пользователя и id опроса является уникальной (и это проверяется в эндпоинте выше)

>user_form_list/<id пользователя>/<id опроса (survey параметр из запроса выше)>/

Выведет подробную форму заполнения конкретного опроса

---

### Админские API эндпоинты:

>survey_create/

Создаёт опрос с использованием подобной JSON структуры:

    {
    "name": "название опроса",
    "date_starts": "дата начала",
    "date_ends": "дата конца",
    "description": "описание опроса",
    "questions": [
         {            
            "question_type": "тип вопроса, возможны варианты: TEXT_ANSWER, ONE_CHOICE и MULTIPLE_CHOICES",
            "required": <boolean переменная зарезервированная, но не используемая в обработке пока - отображает обязателен ли вопроса для заполнения. Принимает значения true/false>,
            "question_text": "текст вопроса",
            "question_order": <int переменная для обозначения в каком порядке идут вопросы>,
            "question_choices": []
        },
        {
            "question_type": "MULTIPLE_CHOICES",
            "required": false,
            "question_text": "",
            "question_order": 2,
            "question_choices": [
                {
                    "choice_order": <int переменная для обозначения в каком порядке идут варианты ответа на вопрос >,
                    "choice_text": "тест варианта"
                },
                {
                    "choice_order": 2,
                    "choice_text": "Is the cake a lie?"
                }
                
            ]
        }

        ]
    }

Принцип думаю понятен

---
>survey_delete/<id опроса>/

Удаление опроса

---

>survey_update/<id опроса>/

Полное или частичное изменение данный в опросе, но без вложенных в него вопросов (то есть не получится использовать ту монструозную, но монолитную конструкцию, что была выше). То есть изменить можно только поля name, date_ends и description

---

### Остальные API эндпоинты, принцип работы которых ничем не примечателен и не опирается на вложенные relationships:

>question_create/

Создание вопроса - можно посмотреть в веб-интерфейсе как создаётся, либо использовать JSON структуру вопроса, без вложенных в него вариантов вопроса из survey_create метода

>question_update/<id вопроса>/

Полное или частичное обновление вопроса

>question_delete/<id вопроса>/

Удаление вопроса

---
По тому же принципу работают эти эндпоинты для вариантов ответа на вопрос:

>question_choice_create/

>question_choice_delete/<id варианта>/

>question_choice_update/<id варианта>/
